<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
<script>
  $(function(){

    var pwd;

    $("#byPhone").css("display","none")   //전화번호 입력창
    $("#byEmail").css("display","none")   //이메일 입력창
    $("#code_validation").css("display","none")
    $("#form_updatePwdbyPhone").css("display","none")

    $('.radio-value').on('click', function() {
      var valueCheck = $('.radio-value:checked').val(); // 체크된 Radio 버튼의 값을 가져옵니다.

      if ( valueCheck == 'phone' ) {
        $("#byPhone").css("display","inline")
        $("#byEmail").css("display","none")
      } else {
        $("#byPhone").css("display","none")
        $("#byEmail").css("display","inline")
      }
    });

    $("#btn_checkByPhone").click(function(e){     //전화번호로 개인정보 확인
      var url = "checkByPhone";
      var custid = $("#custid").val();
      var phone = $("#phone").val();

      console.log("아이디"+custid)
      console.log("전화"+phone)

      $.ajax({
        url:url,
        data:{custid:custid, phone:phone},
        success:function(c){
          console.log("ok")
          console.log(c.pwd)
          pwd = c.pwd;
          if(pwd==undefined){
            $("#printPwdbyPhone").html("정보를 잘못 입력하셨습니다. 다시 입력해주세요.");
          }else{
            $("#printPwdbyPhone").html("");
            $("#code_validation").css("display","block")

            //전화번호 인증 확인
            var authentication = false;
            if (authentication == false) {
              alert("전화번호 인증을 확인해주세요.")
              return false;
            }

          }
        }
      });
      e.preventDefault();

    });     //form_checkByPhone이 제출되었을 때

    // btn_sendPhoneCode
    $("#btn_sendPhoneCode").click(function(){
      var phone = $("#phone").val();
      console.log("전화번호:"+phone);
      var url = "sendMessage";
      var data = {phone:phone};
      $.ajax(url, {
        data:data,
        success: function (answer) {
        }
      });
    });

    $(document).on('click', '#btn_phoneCode', function () { // 인증번호 확인
      var phoneCode = $("#phoneCode").val();
      console.log(phoneCode);
      var url = "CustomerPhoneAuthentication";
      var data = {phoneCode:phoneCode};
      $.ajax(url, {
        data:data,
        success: function (answer) {
          if (answer == 1) {
            alert("인증번호 불일치");
            authentication = false;
          } else {
            alert("인증번호 확인완료.");
            authentication = true;
            $("#form_updatePwdbyPhone").css("display","block")
          }
        }
      });
    }); // 인증번호 확인 end

    $("#btn_updatePwd").click(function(e){    //전화번호로 비밀번호 재설정
      console.log("폰 비번 변경 ok")
      var url = "updatePwdbyPhone";
      var custid = $("#custid").val();
      var phone = $("#phone").val();
      var pwd = $("#pwd").val();

      console.log("아이디"+custid)
      console.log("전화"+phone)
      console.log("비번"+pwd)

      var data = {custid:custid, phone:phone, pwd:pwd};
      console.log(data);

      $.ajax({
        url:url,
        type:"POST",
        data:data,
        beforeSend : function(xhr)
        {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
          xhr.setRequestHeader(header, token);
        },
        success:function(){
          alert("비밀번호가 성공적으로 수정되었습니다.");
          $(location).attr("href","/login");
        }
      });
      e.preventDefault();
    });


  }) // 전체 $(function)

</script>
<body>
<div id="background">
  <a class="main" href="/main">
    <img  src="/images/icon/homeicon.png" width="40" height="40"></a>
</div>
<div>
  <img src="/images/icon/logo.png" id="logo">
  <h2>비밀번호 재설정</h2>
  <input type="radio" class="radio-value" name="findPwd" value="phone">전화번호로 재설정
  <input type="radio" class="radio-value" name="findPwd" value="email">이메일로 재설정
</div>

<!-- 전화번호로 비밀번호 재설정 -->
<div id="byPhone">    <!-- 전화번호 radio -->
  <form id="form_checkByPhone">    <!-- 아이디와 전화번호 입력 form -->
    <table>
      <tr>
        <td>아이디</td>
        <td><input type="text" name="custid" class="box" size="10" id="custid"></td>
      </tr>
      <tr>
        <td>전화번호</td>
        <td>
          <input type ="text" id ="phone" name="phone" maxlength="11" size = "12" class="box">
        </td>
      </tr>
    </table>
    <input type="submit" id="btn_checkByPhone" value="개인정보 확인" name="btn_checkByPhone"><br>
  </form>    <!-- 아이디와 전화번호 입력 form end -->

  <table id="code_validation">
    <tr>
      <td>전화번호 인증</td>
      <td>
        <input type ="text" id ="phoneCode" name="phoneCode" maxlength="6" size = "6" class="box">
        <input type="button" id="btn_sendPhoneCode" value="인증번호 보내기">
        <input type="button" id="btn_phoneCode" value="인증번호 확인">
      </td>
    </tr>
  </table>
  <div><b id="printPwdbyPhone"></b></div>

  <div id="form_updatePwdbyPhone">
    <table>
      <tr>
        <td>비밀번호</td>
        <td><input type="password" name="pwd" class="box" id="pwd" ></td>
      </tr>
      <tr>
        <td colspan="2" class="info">* 최소 6자 이상 소대문자 영문, 숫자, 특수문자로 입력</td>
      </tr>
      <tr>
        <td>비밀번호 확인</td>
        <td><input type="password" class="box" id="pwd_confirm" name="pwd_confirm"></td>
      </tr>
    </table>
    <div>
      <button id="btn_updatePwd" type="submit">비밀번호 재설정</button>
    </div>
  </div>
</div>


<!-- 이메일로 비밀번호 재설정 -->
<div id="byEmail">
  <form id="form_checkByEmail">    <!-- 아이디와 전화번호 입력 form -->
    <table>
      <tr>
        <td>아이디</td>
        <td><input type="text" name="custid" class="box" size="10" id="custid2"></td>
      </tr>
      <tr>
        <td>이메일</td>
        <td>
          <input type ="text" id ="email" email="phone" maxlength="11" size = "12" class="box">
        </td>
      </tr>
    </table>
    <input type="submit" id="btn_checkByEmail" value="개인정보 확인" name="btn_checkByEmail"><br>
  </form>    <!-- 아이디와 전화번호 입력 form end -->

  <table id="code_validation2">
    <tr>
      <td>이메일 인증</td>
      <td>
        <input type ="text" id ="emailCode" name="phoneCode" maxlength="6" size = "6" class="box">
        <input type="button" id="btn_sendEmailCode" value="인증번호 보내기">
        <input type="button" id="btn_emailCode" value="인증번호 확인">
      </td>
    </tr>
  </table>
  <div><b id="printPwdbyEmail"></b></div>

  <form id="form_updatePwdbyEmail">
    <table>
      <tr>
        <td>비밀번호</td>
        <td><input type="password" name="pwd" class="box" id="pwd2" ></td>
      </tr>
      <tr>
        <td colspan="2" class="info">* 최소 6자 이상 소대문자 영문, 숫자, 특수문자로 입력</td>
      </tr>
      <tr>
        <td>비밀번호 확인</td>
        <td><input type="password" class="box" id="pwd_confirm2" name="pwd_confirm"></td>
      </tr>
    </table>
    <div>
      <button id="btn_updatePwd2" type="submit">비밀번호 재설정</button>
    </div>
  </form>
</div>

</body>
</html>